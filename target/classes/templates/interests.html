<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/img/mini_logo.png" type="image/x-icon">
    <link th:href="@{/css/login.css}" rel="stylesheet"  type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" crossorigin="anonymous">
    <title>Interests</title>
</head>
<body>
<div class="wrapper fadeInDown">
    <div id="formContent">
        <h2 class="active"> Choose interests: </h2>

        <div id="result_msg"></div>

        <div class="fadeIn third">
            <ul class="ks-cboxtags">
                <li><input type="checkbox" id="checkboxOne" value="Football"><label for="checkboxOne">Football</label></li>
                <li><input type="checkbox" id="checkboxTwo" value="Sport"><label for="checkboxTwo">Sport</label></li>
                <li><input type="checkbox" id="checkboxThree" value="Basketball"><label for="checkboxThree">Basketball</label></li>
                <li><input type="checkbox" id="checkboxFour" value="Books"><label for="checkboxFour">Books</label></li>
                <li><input type="checkbox" id="checkboxFive" value="Movies"><label for="checkboxFive">Movies</label></li>
                <li><input type="checkbox" id="checkboxSix" value="Painting"><label for="checkboxSix">Painting</label></li>
                <li><input type="checkbox" id="checkboxSeven" value="TableGames"><label for="checkboxSeven">Table Games</label></li>
                <li><input type="checkbox" id="checkboxEight" value="Music"><label for="checkboxEight">Music</label></li>
                <li><input type="checkbox" id="checkboxNine" value="Twitch"><label for="checkboxNine">Twitch</label></li>
                <li><input type="checkbox" id="checkboxTen" value="Netflix"><label for="checkboxTen">Netflix</label></li>
                <li><input type="checkbox" id="checkboxEleven" value="Politics"><label for="checkboxEleven">Politics</label></li>
                <li><input type="checkbox" id="checkboxTwelve" value="Tea"><label for="checkboxTwelve">Tea</label></li>
                <li><input type="checkbox" id="checkboxThirteen" value="Swimming"><label for="checkboxThirteen">Swimming</label></li>
                <li><input type="checkbox" id="checkboxFourteen" value="Beer"><label for="checkboxFourteen">Beer</label></li>
                <li><input type="checkbox" id="checkboxFifteen" value="Bicycling"><label for="checkboxFifteen">Bicycling</label></li>
                <li><input type="checkbox" id="checkbox16" value="TikTok"><label for="checkbox16">TikTok</label></li>
                <li><input type="checkbox" id="checkbox17" value="Museum"><label for="checkbox17">Museum</label></li>
                <li><input type="checkbox" id="checkbox18" value="Dance"><label for="checkbox18">Dance</label></li>
                <li><input type="checkbox" id="checkbox19" value="Cooking"><label for="checkbox19">Cooking</label></li>
                <li><input type="checkbox" id="checkbox20" value="Hockey"><label for="checkbox20">Hockey</label></li>
                <li><input type="checkbox" id="checkbox21" value="Manga"><label for="checkbox21">Manga</label></li>
                <li><input type="checkbox" id="checkbox22" value="MartialArts"><label for="checkbox22">Martial Arts</label></li>
                <li><input type="checkbox" id="checkbox23" value="Marvel"><label for="checkbox23">Marvel</label></li>
                <li><input type="checkbox" id="checkbox24" value="Running"><label for="checkbox24">Running</label></li>
                <li><input type="checkbox" id="checkbox25" value="Gym"><label for="checkbox25">Gym</label></li>
                <li><input type="checkbox" id="checkbox26" value="IceSkating"><label for="checkbox26">IceSkating</label></li>
                <li><input type="checkbox" id="checkbox27" value="Singing"><label for="checkbox27">Singing</label></li>
                <li><input type="checkbox" id="checkbox28" value="Karaoke"><label for="checkbox28">Karaoke</label></li>
                <li><input type="checkbox" id="checkbox29" value="Memes"><label for="checkbox29">Memes</label></li>
                <li><input type="checkbox" id="checkbox30" value="NFT"><label for="checkbox30">NFT</label></li>
                <li><input type="checkbox" id="checkbox31" value="Fishing"><label for="checkbox31">Fishing</label></li>
                <li><input type="checkbox" id="checkbox32" value="Investing"><label for="checkbox32">Investing</label></li>
                <li><input type="checkbox" id="checkbox33" value="Cosplay"><label for="checkbox33">Cosplay</label></li>
                <li><input type="checkbox" id="checkbox34" value="Bowling"><label for="checkbox34">Bowling</label></li>
                <li><input type="checkbox" id="checkbox35" value="Gardening"><label for="checkbox35">Gardening</label></li>
                <li><input type="checkbox" id="checkbox36" value="Photography"><label for="checkbox36">Photography</label></li>
                <li><input type="checkbox" id="checkbox37" value="Yoga"><label for="checkbox37">Yoga</label></li>
                <li><input type="checkbox" id="checkbox38" value="Chess"><label for="checkbox38">Chess</label></li>
                <li><input type="checkbox" id="checkbox39" value="Travel"><label for="checkbox39">Travel</label></li>
                <li><input type="checkbox" id="checkbox40" value="Coding"><label for="checkbox40">Coding</label></li>
                <li><input type="checkbox" id="checkbox41" value="Guitar"><label for="checkbox41">Guitar</label></li>
                <li><input type="checkbox" id="checkbox42" value="Cats"><label for="checkbox42">Cats</label></li>
                <li><input type="checkbox" id="checkbox43" value="Dogs"><label for="checkbox43">Dogs</label></li>
                <li><input type="checkbox" id="checkbox44" value="Hiking"><label for="checkbox44">Hiking</label></li>
                <li><input type="checkbox" id="checkbox45" value="Snowboarding"><label for="checkbox45">Snowboarding</label></li>
                <li><input type="checkbox" id="checkbox46" value="Fashion"><label for="checkbox46">Fashion</label></li>
                <li><input type="checkbox" id="checkbox47" value="Camping"><label for="checkbox47">Camping</label></li>
                <li><input type="checkbox" id="checkbox48" value="Writing"><label for="checkbox48">Writing</label></li>
                <li><input type="checkbox" id="checkbox49" value="Surfing"><label for="checkbox49">Surfing</label></li>
                <li><input type="checkbox" id="checkbox50" value="Skiing"><label for="checkbox50">Skiing</label></li>
                <li><input type="checkbox" id="checkbox51" value="Reading"><label for="checkbox51">Reading</label></li>
                <li><input type="checkbox" id="checkbox52" value="Piano"><label for="checkbox52">Piano</label></li>
                <li><input type="checkbox" id="checkbox53" value="Coffee"><label for="checkbox53">Coffee</label></li>
                <li><input type="checkbox" id="checkbox54" value="Fitness"><label for="checkbox54">Fitness</label></li>
                <li><input type="checkbox" id="checkbox55" value="Gaming"><label for="checkbox55">Gaming</label></li>
                <li><input type="checkbox" id="checkbox56" value="Nature"><label for="checkbox56">Nature</label></li>
                <li><input type="checkbox" id="checkbox57" value="Sims"><label for="checkbox57">Sims</label></li>
                <li><input type="checkbox" id="checkbox58" value="MakeUp"><label for="checkbox58">MakeUp</label></li>
            </ul>
        </div>
        <button type="submit" id="registrationButton" class="button fadeIn fourth">Send</button>

    </div>
</div>
</body>

<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">

    if (getCookie("Authorization") == null) {
        window.location.replace("/loginUser");
    }

    function parseJwt(token) {
        let base64Url = token.split('.')[1];
        let base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        let jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));

        return JSON.parse(jsonPayload);
    }

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    $(document).ready(function () {
        let myCookie = getCookie("Authorization");
        let resultC = parseJwt(myCookie);
        let email = resultC.sub;
        var interests = [];

        if (getCookie("Authorization") != null) {
            let resultC = parseJwt(myCookie);
            let email = resultC.sub;

            $.ajax({
                type: "GET",
                headers: {'Authorization': myCookie},
                contentType: 'application/json',
                url: "getUser",
                data: {email: email},
                dataType: 'json',
                success: function (result) {
                    user_info = result;
                    if (result.interests !== null) {
                        interests = result.interests;

                        // Loop through the checkboxes and check the ones that match the interests
                        $('.ks-cboxtags input[type=checkbox]').each(function() {
                            if (interests.indexOf($(this).val()) !== -1) {
                                $(this).prop('checked', true);
                            }
                        });
                    }

                },
                error: function (e) {
                    console.log("ERROR: ", e);
                    window.location.replace("/loginUser");
                }
            });
        } else {
            window.location.replace("/loginUser");
        }


        $("input:checkbox").change(function() {
            if($(this).is(":checked")) {
                interests.push(this.value);
                console.log(this.value + " added");
            } else {
                let pos = interests.indexOf(this);
                interests.splice(pos, 1);
                console.log("not added");
            }
        });

            $('#registrationButton').on('click', function () {
                let data = JSON.stringify({email:email, interests: interests});
                if (interests.length > 2) {
                    $.ajax({
                        type: "POST",
                        contentType: 'application/json',
                        url: "setInterests",
                        data: data,
                        dataType: 'json',
                        complete: function (result) {
                            console.log(result.responseText);
                            if (result.responseText == "Interests were set") {
                                //console.log(123);
                                window.location.replace("/profile");
                            } else {
                                $('#result_msg').css("border", "1px solid red")
                                $('#result_msg').html(result.responseText);
                            }
                        }
                    })
                }
                else {
                    $('#result_msg').css("border", "1px solid red");
                    $('#result_msg').html("Please select at least 3 interests");
                }

            })

        }
    );
</script>
</html>